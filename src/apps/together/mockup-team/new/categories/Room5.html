<!DOCTYPE html>
  <html>
    <head>
    <ul id="tab_title">
	<ul>
    <link rel="icon" type="x-icon" href="images/ficon.ico">
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>

    <body>
	    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
        <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>

		<ul id="categories_dropdown" class="dropdown-content">
		</ul>
		<div class="navbar-fixed">
		<nav>
		<nav class = "light-green darken-3"
		  <div class="nav-wrapper">
		    <ul id="category_title">
            </ul>
		    <ul class="right hide-on-med-and-down">
		      <li><a href="/apps/together/mockup-team/index.html">Home</a></li>
		      <li><a href="#">Login</a></li>
		      <!-- Dropdown -->
		      <li><a class="dropdown-button" href="#!" data-activates="categories_dropdown">Categories<i class="material-icons right">arrow_drop_down</i></a></li>
		    </ul>
		  </div>
		</nav>
	</nav>
	</div>    

  <div class="container">
    <div class="section">
      <div class="row">
      <ul id="video_link">
	  </ul>

      <div class="right col l5 m5 s5" style="margin-top:14%;">
        <div class="card-panel light-green darken-1">
          <h4 class="card-title" class = "center"><b>Live Poll</b></h4>
        <canvas id="myChart" class="center"></canvas>
        <canvas id="myChart2" class="center"></canvas>
        <div class="row center">
          <a class="center waves-effect waves-light red btn">Red</a>
          <a class="center waves-effect waves-light blue btn">Blue</a>
       </div>
      </div>
     </div>
    </div> 
  </div>
    <div class="row">
      <div class="col s12 m5">
        <div class="card-panel light-green darken-1">
          <span class="white-text"><h5> Current Users in Room: </h5>
            <ul  id="name">
            </ul>
          </span>
        </div>
      </div>
    </div>
</div>
      
      <script>
        var ref = new Firebase('https://team-polive.firebaseio.com/users')
        var roomsRef = new Firebase('https://team-polive.firebaseio.com/rooms/');
		
		//Set title once
		setTitle();
		//Set video once
		setVideo();
		
        ref.orderByChild("room").equalTo("Room5").on('value', function(snapshot){
          var user = snapshot.val()
		  //Clear card content before loading in users
		  document.getElementById("name").innerHTML = "";
          snapshot.forEach(function(users) {
            var name = users.child("name").val()
            $('#name').append('<li class="collection-item">' + name + '</li>') 
            })
        })
		
		//Load active rooms
		//Only add rooms that are active i.e. NOT available, if available then no debate currently active
	    roomsRef.orderByChild("available").equalTo(0).on("value", function(snapshot) {
	    //clear old rooms
	    document.getElementById('categories_dropdown').innerHTML = "";
		  //Add available rooms
		  snapshot.forEach(function(data) {
		    var room = data.key();
		    roomsRef.child(room).once("value", function(snapshot){
			  snapshot.forEach(function(childSnapshot) {
				if(childSnapshot.key() == 'name'){
					$('#categories_dropdown').append('<li><a href="/apps/together/mockup-team/categories/'+room+'.html">'+childSnapshot.val()+'</a></li><li class="divider"></li>');
				}
			  })
		    });
		  });
	    });
		
		function setTitle(){
		    var ref = new Firebase('https://team-polive.firebaseio.com/rooms/Room5');
			var title = "";
			ref.once("value", function(data) {
			    title = data.val();
			    //console.log(title.name)
				$('#category_title').append('<a href="#!" class="brand-logo center">' +title.name+ ' <img src="olive.png" height="20px" style="margin-top:15px;"></a>');
				$('#tab_title').append('<title>Polive - '+ title.name+'</title>');
			});

			return;
		}
		function setVideo(){
		    var ref = new Firebase('https://team-polive.firebaseio.com/rooms/Room5');
			var video = "";
			ref.once("value", function(data) {
			    video = data.val();

				$('#video_link').append('<div class="video col l7 m7 s6 left"><iframe style="width:100%; height:400px; margin-top:20%;" src='+video.video+' frameborder="0" allowfullscreen></iframe></div>');
			});

			return;
		}
      </script>
 
      <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
      <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.0.0/lodash.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
      <script src="js/Chart.js"></script>
      <script src="js/init.js"></script>
      <script>
    var data = [
      {
          value: 30,
          color:"#F7464A",
          highlight: "#FF5A5E",
          label: "Red"
      },
      {
          value: 50,
          color: "#46BFBD",
          highlight: "#5AD3D1",
          label: "Green"
      }
    ]
    var ctx = document.getElementById("myChart").getContext("2d");
    var myDoughnutChart = new Chart(ctx).Doughnut(data);
    var ctx = document.getElementById("myChart2").getContext("2d");
    var data = {
    labels: ["January", "February", "March", "April", "May", "June", "July"],
    datasets: [
        {
            label: "My First dataset",
            fillColor: "rgba(220,220,220,0.2)",
            strokeColor: "rgba(220,220,220,1)",
            pointColor: "rgba(220,220,220,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: [65, 59, 80, 81, 56, 55, 40]
        },
        {
            label: "My Second dataset",
            fillColor: "rgba(151,187,205,0.2)",
            strokeColor: "rgba(151,187,205,1)",
            pointColor: "rgba(151,187,205,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(151,187,205,1)",
            data: [28, 48, 40, 19, 86, 27, 90]
        }
    ]
};
    var options = {bezierCurve: false}
    var myLineChart = new Chart(ctx).Line(data, options);
  </script>
    </body>
  </html>
